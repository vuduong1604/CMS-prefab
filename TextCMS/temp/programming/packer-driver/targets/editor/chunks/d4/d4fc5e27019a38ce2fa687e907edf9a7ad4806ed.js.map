{"version":3,"sources":["file:///D:/CMS/TextCMS/assets/Scripts/Gamemanager.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","Label","SpriteFrame","find","Sprite","Item","ccclass","property","Gamemanager","i","maxpage","baseUrlfile","nodeupload","onLoad","window","addEventListener","e","data","method","console","log","loadData","params","start","myHeaders","Headers","append","requestOptions","headers","redirect","fetch","then","response","text","result","JSON","parse","fileUrl","top","display","catch","error","length","AddItem","ListItem","getComponent","iditem","string","id","LoadData","jsonData","forEach","element","active","a","parent","BG","PageName","toString","push","Noti","SubItem","destroy","pop","content","noti","setSiblingIndex","getChildByName","closeNoti","OpenpopupUpload","node","popupupload","name","button_tpnl","ClosepopupUpload","Next","index","Number","Prev","uploadimg","UploadFile","cc","sys","isBrowser","ipFile","document","createElement","type","accept","click","img","canvas","reader","FileReader","onload","progressEvent","src","target","ctx","getContext","drawImage","MAX_WIDTH","MAX_HEIGHT","width","height","dataUrl","toDataURL","replace","res","arrayBuffer","buffer","files","readAsDataURL","formdata","FormData","body","classItem","url","setImage","xoaamthanh","spriteFrame","disableSoundSprite","addtpnl","showmodal","SaveGame","listitemdata","getData","item","stringify","receiveData"],"mappings":"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","sourcesContent":["import {\r\n  _decorator,\r\n  Component,\r\n  Node,\r\n  Prefab,\r\n  instantiate,\r\n  Label,\r\n  assetManager,\r\n  SpriteFrame,\r\n  Texture2D,\r\n  find,\r\n  Sprite,\r\n} from \"cc\";\r\nimport { Item } from \"./Item\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"Gamemanager\")\r\nexport class Gamemanager extends Component {\r\n  @property(Prefab)\r\n  Item: Prefab = null;\r\n\r\n  @property(Node)\r\n  BG: Node = null;\r\n\r\n  @property(Node)\r\n  noti: Node = null;\r\n  @property(Node)\r\n  popupupload: Node = null;\r\n\r\n  @property(Node)\r\n  button_tpnl: Node = null;\r\n\r\n  @property(Node)\r\n  ListItem: Node[] = [];\r\n\r\n  @property(SpriteFrame)\r\n  disableSoundSprite: SpriteFrame = null;\r\n\r\n  @property(SpriteFrame)\r\n  enableSoundSprite: SpriteFrame = null;\r\n\r\n  i = 0;\r\n  maxpage = 10;\r\n\r\n  baseUrlfile = \"https://ctm-cms.myg.vn\";\r\n\r\n  onLoad() {\r\n    window.addEventListener(\"message\", (e) => {\r\n      var data = e.data;\r\n      // console.log(\"Data=> \", e.data);\r\n\r\n      // console.log(\"Method =>> \", data.method);\r\n\r\n      // console.log(\"Params =>> \", data.params);\r\n      if (data.method == \"setimage\") {\r\n      }\r\n      if (data.method == \"setsound\") {\r\n      }\r\n      if (data.method == \"loaddata\") {\r\n        console.log(\"Nhận data từ cms\");\r\n        this.loadData(data.params.data);\r\n      }\r\n    });\r\n  }\r\n\r\n  start() {\r\n    //this.AddItem();\r\n\r\n    var myHeaders = new Headers();\r\n    myHeaders.append(\r\n      \"Cookie\",\r\n      \".AspNetCore.Session=CfDJ8GmrYVI6VxlFp5hvVMclUtbNYSmkex1UtQdZ6smB73vnw%2FSlHIHLyBsSs49nxoK2jNqvBJyT2It39gKhkIsNIJiRbIW5FRzG44gYrHZS%2BWb8Z16d36OZAUXKppJBY87rjLyA878IoIyeXuA3koV8x%2BPFlMabeTalTDMkpaKf4pw3\"\r\n    );\r\n\r\n    var requestOptions = {\r\n      method: \"GET\",\r\n      headers: myHeaders,\r\n      redirect: \"follow\",\r\n    };\r\n\r\n    fetch(\"https://dev-cms-teacher.consangtao.vn/Api/UrlBase\", requestOptions)\r\n      .then((response) => response.text())\r\n      .then((result) => this.baseUrlfile = JSON.parse(result).fileUrl, window.top.display())\r\n      .catch((error) => window.top.display());\r\n\r\n  }\r\n\r\n  loadData(data) {\r\n    // console.log(data);\r\n    for (var i = 0; i < data.length; i++) {\r\n      this.AddItem();\r\n      this.ListItem[this.ListItem.length - 1].getComponent(Item).iditem.string =\r\n        data[i].id;\r\n      this.ListItem[this.ListItem.length - 1]\r\n        .getComponent(Item)\r\n        .LoadData(data[i].jsonData);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * AddItem\r\n   */\r\n  public AddItem() {\r\n    if (this.ListItem.length < this.maxpage) {\r\n      this.i = this.ListItem.length + 1;\r\n      this.ListItem.forEach((element) => {\r\n        element.active = false;\r\n      });\r\n\r\n      var a = instantiate(this.Item);\r\n      a.parent = this.BG;\r\n      a.getComponent(Item).PageName.string = this.i.toString();\r\n      this.ListItem.push(a);\r\n      this.ListItem.forEach((element) => {\r\n        console.log(element.getComponent(Item).PageName.string);\r\n      });\r\n    } else {\r\n      this.Noti(\"Bạn không thể tạo thêm nữa!!!\");\r\n    }\r\n  }\r\n\r\n  public SubItem() {\r\n    if (this.ListItem.length > 0) {\r\n      this.ListItem[this.ListItem.length - 1].destroy();\r\n      this.ListItem.pop();\r\n      console.log(\"length=> \", this.ListItem.length);\r\n      // this.ListItem.forEach(element => {\r\n      //     console.log(element.getComponent(Item).PageName.string);\r\n      // });\r\n      if (this.ListItem.length > 0) {\r\n        this.ListItem[this.ListItem.length - 1].active = true;\r\n      }\r\n      this.i = this.ListItem.length;\r\n    } else {\r\n      this.Noti(\"Bạn không thể xóa thêm nữa!!!\");\r\n    }\r\n  }\r\n\r\n  public Noti(content) {\r\n    this.noti.active = true;\r\n    this.noti.setSiblingIndex(100000);\r\n    this.noti.getChildByName(\"Label\").getComponent(Label).string = content;\r\n  }\r\n  public closeNoti() {\r\n    this.noti.active = false;\r\n  }\r\n  nodeupload = null; // node click upload\r\n  public OpenpopupUpload(node) {\r\n    this.popupupload.active = true;\r\n    this.popupupload.setSiblingIndex(100000);\r\n    this.nodeupload = node;\r\n    console.log(\"nodeupload =>\", this.nodeupload);\r\n    if (this.nodeupload.name != \"question\") {\r\n      this.button_tpnl.active = false;\r\n    }\r\n    if (this.nodeupload.name == \"question\") {\r\n      if (\r\n        this.nodeupload.parent.getChildByName(\"iditem\").getComponent(Label)\r\n          .string != \"00000000-0000-0000-0000-000000000000\"\r\n      ) {\r\n        this.button_tpnl.active = true;\r\n      } else {\r\n        this.button_tpnl.active = false;\r\n      }\r\n    }\r\n  }\r\n  public ClosepopupUpload() {\r\n    this.popupupload.active = false;\r\n  }\r\n\r\n  public Next() {\r\n    var index = 0; // id page dang active\r\n    this.ListItem.forEach((element) => {\r\n      if (element.active == true) {\r\n        index = Number(element.getComponent(Item).PageName.string);\r\n      }\r\n    });\r\n    console.log(\"Page đang active => \", index);\r\n    if (index < this.ListItem.length) {\r\n      this.ListItem[index - 1].active = false;\r\n      this.ListItem[index].active = true;\r\n    }\r\n  }\r\n\r\n  public Prev() {\r\n    var index = 0; // id page dang active\r\n    this.ListItem.forEach((element) => {\r\n      if (element.active == true) {\r\n        index = Number(element.getComponent(Item).PageName.string);\r\n      }\r\n    });\r\n    console.log(\"Page đang active => \", index);\r\n    if (index > 1) {\r\n      this.ListItem[index - 1].active = false;\r\n      this.ListItem[index - 2].active = true;\r\n    }\r\n  }\r\n\r\n  // =============================== UPLOAD ======================================\r\n\r\n  uploadimg() {\r\n    this.UploadFile(this.nodeupload);\r\n  }\r\n\r\n  //call từ bên item\r\n  UploadFile(node) {\r\n    if (cc.sys.isBrowser) {\r\n      let ipFile = document.createElement(\"input\");\r\n      ipFile.type = \"file\";\r\n      ipFile.accept = \"image/png/mp3\";\r\n      console.log(\"ipFile\", ipFile);\r\n      ipFile.click();\r\n      ipFile.addEventListener(\r\n        \"change\",\r\n        () => {\r\n          var img = document.createElement(\"img\");\r\n          var canvas = document.createElement(\"canvas\");\r\n          var reader = new FileReader();\r\n          reader.onload = function (progressEvent) {\r\n            img.src = progressEvent.target.result;\r\n            img.onload = function () {\r\n              // access image size here\r\n              var ctx = canvas.getContext(\"2d\");\r\n              ctx.drawImage(img, 0, 0);\r\n\r\n              var MAX_WIDTH = 800;\r\n              var MAX_HEIGHT = 600;\r\n              var width = img.width;\r\n              var height = img.height;\r\n\r\n              if (width > height) {\r\n                if (width > MAX_WIDTH) {\r\n                  height *= MAX_WIDTH / width;\r\n                  width = MAX_WIDTH;\r\n                }\r\n              } else {\r\n                if (height > MAX_HEIGHT) {\r\n                  width *= MAX_HEIGHT / height;\r\n                  height = MAX_HEIGHT;\r\n                }\r\n              }\r\n              canvas.width = width;\r\n              canvas.height = height;\r\n              var ctx = canvas.getContext(\"2d\");\r\n              ctx.drawImage(img, 0, 0, width, height);\r\n              var dataUrl = canvas.toDataURL(\"image/png\");\r\n              console.log(\"buffer\", dataUrl);\r\n              dataUrl =\r\n                \"data:application/octet-binary;base64,\" +\r\n                dataUrl.replace(\"data:image/png;base64,\", \"\");\r\n              fetch(dataUrl)\r\n                .then((res) => res.arrayBuffer())\r\n                .then((buffer) => {\r\n                  console.log(\"buffer\", buffer);\r\n                });\r\n            };\r\n          };\r\n          console.log(\"ipFile.files[0]\", ipFile.files);\r\n          reader.readAsDataURL(ipFile.files[0]);\r\n          // call Api\r\n\r\n          var myHeaders = new Headers();\r\n          myHeaders.append(\r\n            \"Cookie\",\r\n            \".AspNetCore.Session=CfDJ8GmrYVI6VxlFp5hvVMclUtanrpD%2BHH0oRRUDw6oaMn3NwyayHlyo3pNzp%2BEoa5sTRFRu%2Fiycjkfhs3cCAhcMz%2FI7uzsM8IQhc14aMSSnuv8PAShbhhpB538WNIJQxIwHCpD%2BNRNl1pW04TW%2FgN9%2BD%2BQcZFNbTHkI7U%2BOu4E7BK59\"\r\n          );\r\n\r\n          var formdata = new FormData();\r\n          formdata.append(\"Item\", ipFile.files[0], ipFile.files[0].name);\r\n          formdata.append(\"ClassItem\", node.name);\r\n\r\n          var requestOptions = {\r\n            method: \"POST\",\r\n            headers: myHeaders,\r\n            body: formdata,\r\n            redirect: \"follow\",\r\n          };\r\n\r\n          fetch(\r\n            \"https://dev-cms-teacher.consangtao.vn/Api/UploadFile\",\r\n            requestOptions\r\n          )\r\n            .then((response) => response.text())\r\n            .then((result) => {\r\n              console.log(result);\r\n              let classItem = JSON.parse(result).classItem;\r\n              let url = JSON.parse(result).url;\r\n\r\n              this.setImage(url, node);\r\n            })\r\n            .catch((error) => console.log(\"error\", error));\r\n        },\r\n        false\r\n      );\r\n    }\r\n  }\r\n\r\n  xoaamthanh() {\r\n    console.log(\"xoa am thanh\", this.nodeupload);\r\n    find(\"sound/Label_sound\", this.nodeupload).getComponent(Label).string = \"\";\r\n    find(\"sound\", this.nodeupload).getComponent(Sprite).spriteFrame =\r\n      this.disableSoundSprite;\r\n  }\r\n\r\n  // setImage(remoteUrl, node) {\r\n  //   this.ClosepopupUpload();\r\n  //   var typefile = remoteUrl.substr(remoteUrl.length - 3);\r\n  //   console.warn(\"typefile=>\", typefile);\r\n  //   if (typefile == \"png\" || typefile == \"jpg\") {\r\n  //     assetManager.loadRemote(remoteUrl, (err, imageAsset) => {\r\n  //       var spr = find(\"Mask/Sprite\", node);\r\n  //       console.log(spr);\r\n\r\n  //       const spriteFrame = new SpriteFrame();\r\n  //       const tex = new Texture2D();\r\n  //       tex.image = imageAsset;\r\n  //       spriteFrame.texture = tex;\r\n  //       spr.getComponent(Sprite).spriteFrame = spriteFrame;\r\n  //     });\r\n\r\n  //     var textlabel = find(\"Mask/Sprite/Label_sprite\", node);\r\n  //     textlabel.getComponent(Label).string = remoteUrl;\r\n  //   }\r\n  //   if (typefile == \"mp3\") {\r\n  //     var textlabel = find(\"sound/Label_sound\", node);\r\n  //     textlabel.getComponent(Label).string = remoteUrl;\r\n  //     find(\"sound\", node).getComponent(Sprite).spriteFrame =\r\n  //       this.enableSoundSprite;\r\n  //   }\r\n  // }\r\n\r\n  addtpnl() {\r\n    window.top.showmodal(\r\n      [],\r\n      this.nodeupload.parent.getChildByName(\"iditem\").getComponent(Label)\r\n        .string,\r\n      0\r\n    );\r\n  }\r\n\r\n  // upload data cms\r\n\r\n  public SaveGame() {\r\n    var listitemdata = [];\r\n    this.ListItem.forEach((element) => {\r\n      element.getComponent(Item).getData();\r\n      listitemdata.push(element.getComponent(Item).item);\r\n    });\r\n\r\n    if(listitemdata == null || listitemdata.length == 0){\r\nthis.Noti(\"Tối thiểu 1 câu.\")\r\n    }\r\n    else{\r\n      console.log(JSON.stringify(listitemdata));\r\n    window.top.receiveData(JSON.stringify(listitemdata));\r\n    }\r\n  }\r\n}\r\n"]}